<style>
:root {
    font-size: 12px;
    --control-color-grey: rgb(200,200,200);
    --control-color-green: #49A564;
    --button-color-blue: #1A6AD3;
    --color-white: #FFFFFF;
    --color-black: #0000;
}

.button {
  float: left;
  margin: 0 2rem 0 0;
  width: 200px;
  height: 40px;
  position: relative;
}

.button label,
.button input {
    display: block;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    align-items: center;
    border-radius: 4px;
    border: 3px solid var(--button-color-blue);
    font-family: 'Public Sans';
    font-style: normal;
    font-weight: 700;
    font-size: 16px;
    line-height: 19px;
    text-align: center;
    color: var(--button-color-blue);
}

.button input[type="radio"] {
  opacity: 0.011;
  z-index: 100;
}

.button input[type="radio"]:checked + label {
  background: var(--button-color-blue);
  color: var(--color-white);
}

.button label {
  cursor: pointer;
  z-index: 90;
  line-height: 1.8em;
}

input[type=checkbox] {
    -webkit-appearance: none;
    appearance: none;
    margin: 0;
    transform: scale(1);
    width: 2rem;
    height: 2rem;
    cursor: pointer;
    font-size: 17px;
    visibility: hidden;
}

input[type=checkbox]:after,
input[type=checkbox]::after {
    content: " ";
    display: inline-block;

    min-width: 3rem;
    min-height: 3rem;
    visibility: visible;
    border: 2px solid var(--control-color-green);
    border-radius: 5px;
}

input[type=checkbox]:checked {
    color: var(--color-white);
}
input[type=checkbox]:checked:after,
input[type=checkbox]:checked::after {
    content: "\2713";
    font-weight: bold;
    background-color: var(--control-color-green);
    padding: 0px 25%;
}

input[type="radio"] {
  -webkit-appearance: none;
  appearance: none;
  margin: 0;

  font: inherit;
  color: var(--control-color-green);
  min-width: 3rem;
  min-height: 3rem;
  border: 0.2rem solid var(--control-color-green);
  border-radius: 50%;
  display: grid;
  place-content: center;
}

input[type="radio"]::before {
  content: "";
  width: 2rem;
  height: 2rem;
  border-radius: 50%;
  transform: scale(0);
  box-shadow: inset 2rem 2rem var(--control-color-green);
  /* Windows High Contrast Mode */
  background-color: CanvasText;
}

input[type="radio"]:checked::before {
  transform: scale(1);
  background-color: var(--control-color-green);
}

input[type="radio"]:focus {
  outline: max(1px, 2px) solid var(--control-color-green);;
  outline-offset: max(0px, 2px);
  background-color: var(--control-color-green);
}

.quiz-container {
    min-height: 50vh;;
    box-sizing: border-box;
    display: grid;
    grid-template-areas:"progressBar progressBar" 
                        "back questions"
                        "next next";
    grid-template-rows: auto 1fr;
    grid-template-columns: 1fr 5fr;
}

    /* 
    Progressbar 
    */
    .quiz-progress-bar-container {
        width: 100%;
        grid-area: progressBar;
        display: grid;
        grid-template-rows: auto auto;
    }
        .quiz-progress-bar-map-container {
            width: 100%;
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: 3rem;
        }
            .quiz-progress-bar-map-bar {
                background-color: var(--control-color-green);
                margin: 1rem 0;
                width: 0%;
                grid-column-start: 1;
                grid-column-end: 2;
                grid-row-start: 1;
            }
            .quiz-progress-bar-map-bar-back {
                background-color: var(--control-color-grey);
                max-width: 70%;
                margin: 1rem 0;
                grid-column-start: 1;
                grid-column-end: 2;
                grid-row-start: 1;
            }
            
            .quiz-progress-bar-map-bar-markers {
                width: 100%;
                height: 3rem;
                grid-column-start: 1;
                grid-column-end: 2;
                grid-row-start: 1;
                display: grid;
                grid-template-columns: 1fr 1fr 1fr; 
            }
                .quiz-progress-bar-map-bar-marker {
                    width: 100%;
                    height: 100%;
                }
                
        .quiz-progress-bar-labels-container {
            grid-row-start: 2;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr; 
        }
            .quiz-progress-bar-label {
                 padding: 0.5rem;
            }

/* Back button */
    .quiz-back-container {
        grid-area: back;
        display:grid;
    }

        .quiz-back {
            width: 2rem;
            display:grid;
        }

    .quiz-questions-container {
        grid-area: questions;
    }

    .quiz-next {
        font-size: x-large;
        grid-area: next;
        text-align: center;
        margin: auto;
        padding: 2rem;
        color: blue;
    }

    .quiz-next-inactive {
        font-size: x-large;
        grid-area: next;
        text-align: center;
        margin: auto;
        padding: 2rem;
        color: gray;
    }

    .quiz-title-text {
        font-family: 'Public Sans';
        font-style: normal;
        font-weight: 700;
        font-size: 22px;
        line-height: 26px;
        color: #212121;
    }

    .quiz-paragraph-text {
        font-family: 'Public Sans';
        font-style: normal;
        font-weight: 400;
        font-size: 16px;
        line-height: 150%;
        color: #212121;
    }

    .quiz-multiSelect-container {
        display: grid;
        grid-template-rows: auto auto;
        grid-template-columns: auto auto;
        gap: 2rem;
    }
    
    .quiz-multiSelect-card-container {
        display: inline-block;
        min-width: 100%;
        min-height: fit-content;
        border: 2px solid #212121;
        padding: 2rem;
    }

    .quiz-multiSelect-card-container-selected {
        display: inline-block;
        min-width: 100%;
        min-height: fit-content;
        border: 0.2rem solid var(--control-color-green);
        padding: 2rem;
    }

    .quiz-multiSelect-card-title-text {
        font-family: 'Public Sans';
        font-style: normal;
        font-weight: 400;
        font-size: 18px;
        line-height: 21px;
        color: #212121;
    }

    .quiz-multiSelect-card-paragraph-text {
        font-family: 'Public Sans';
        font-style: normal;
        font-weight: 400;
        font-size: 14px;
        line-height: 16px;
        color: #212121;
    }

    .quiz-multiSelect-card-check-container {
        min-width: 3rem;
        min-height: 3rem;
        float: right;
    }

    .quiz-singleSelectRadio-container {
        display: flex;
        flex-direction: row-reverse;
    }
    
    /* Summary */
    .quiz-summary {

    }
        .recomended-loans-container {
            margin: 2rem 0;
        }
            .recomended-loan-card-holder {
                display: flex;
                flex-direction: row;
            }
            .recomended-imageContainer {
                width: 100%;
                height: 260px;
            }
                .recomended-image {
                    width: 100%;
                    height: 260px;
                    object-fit: cover;
                }
            .recomended-loans-card {
                flex-grow: 1;
                flex-basis: 0;
                border: 2px solid black;
            }
                .recomended-loans-card-title {
                    
                }

    .summary-step-container {
        margin: 2rem 0;
    }
    .summary-step {
        height: min-content;
        display:grid;
        grid-template-areas:"header header"
                            "iconholder step-text"
                            "iconholder step-full-report";
        grid-template-columns: 4rem 1fr;
        margin: 2rem 0;
    }
        .summary-step-header {
            grid-area: header;
        }
        .summary-step-iconholder {
            grid-area: iconholder;
            max-height: fit-content;
        }
            .step-bullet {
                border-radius: 50%;
                width: 38px;
                height: 38px;
                text-align: center;
            }
            .step-bullet-green-fill {
                background: var(--control-color-green);
                color: var(--color-white);

            }
            .step-bullet-green-border {
                border: 3px solid var(--control-color-green);
                color: var(--control-color-green);
            }
            .step-bullet-grey-border {
                border: 3px solid var(--control-color-grey);
                color: var(--control-color-grey);
                background: var(--color-white);
            } 
        .summary-step-text {
            grid-area: step-text;
            grid-template-rows: auto auto auto;
            margin-left: 1rem;
        }
            .summary-step-text-title {
                height: fit-content;
            }
            .summary-step-text-message {
                height: fit-content;
            }
            .summary-step-text-button-container {
                display: flex;
                flex-direction: row;
                column-gap: 1rem;
            }
                .summary-step-text-button {
                    background-color: var(--button-color-blue);
                    color: var(--color-white);
                    padding: 1rem;
                }

        /* Flags */
        .quiz-summary-flag {
            display: grid;
            grid-template-columns: 8px 4rem 1fr;
            margin: 1rem 0 0;
        }
        .quiz-summary-flag-alert-background { background-color: rgb(255,220,220); }
        .quiz-summary-flag-warning-background { background-color: #F8EDC7; }
            
            .quiz-summary-flag-leftbar {
                width: 100%;
            }
            .quiz-summary-flag-leftbar-alert-background { background-color: rgb(255,80,80); }
            .quiz-summary-flag-leftbar-warning-background { background-color: #FFBE2E; }
            
            .quiz-summary-flag-iconholder {
                padding: 10%;
            }
            .quiz-summary-flag-text {
                display:grid;
                grid-template-rows: auto auto;
            }
                .quiz-summary-flag-text-title {
                    min-height: fit-content;
                    padding: 0.5rem 1rem;
                }
                .quiz-summary-flag-text-message {
                    min-height: fit-content;
                    padding: 0.5rem 1rem;
                }

        /* Full Report */
        .full-report-container {
            padding: 2rem;
            margin: 2rem 0;
            border: 2px solid black;
            grid-area: step-full-report;
        }

        .full-report-result-container {
            margin: 1rem 0;
            display: grid;
            grid-template-columns: 4rem 1fr;
        }
            .full-report-result-bullet-container {
                width: 100%;
            }
            .full-report-result-info {
                display: grid;
                grid-template-rows: auto auto auto;
            }
                .full-report-result-info-title {
                }
                .full-report-result-info-message {
                }
                .full-report-result-info-flag {
                }
    
    /* Full Report */
    .result-container {
        padding: 3rem;
    }
        .result-image-container {

        }
            .result-image {
                width:25%

            }
        .result-title {

        }
        .result-subTitle {

        }
        .result-recommendation {

        }
            .result-recommendation-description {

            }
            .result-recommendation-note {

            }
            .result-recommendation-fullQuizText {

            }
            .result-recommendation-fullQuizSubText {
                
            }
            .result-tile-container {
                margin: 1rem;
            }
                .result-tile {
                    font-family: 'Public Sans';
                    font-style: normal;
                    font-weight: 700;
                    font-size: 16px;
                    line-height: 19px;
                    display: grid;
                    grid-template-columns: 3rem 1fr;
                    grid-template-rows: auto auto;
                    margin: 0.5rem 0;
                }
                    .result-number {
                        padding: 0.25rem;
                        grid-column-start: 1;
                        grid-row-start: 1;
                    }
                    .result-question {
                        padding: 0.25rem;
                        grid-column-start: 2;
                        grid-row-start: 1;
                    }
                    .result-answer {
                        font-style: bold;
                        padding: 0.25rem;
                        grid-column-start: 2;
                        grid-row-start: 2;
                    }
</style>

<div class="fit-content">
    <div class="container" id="summary-container"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.4.0/jspdf.debug.js"></script>
<script type="text/javascript" src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.js"></script>


<script src="../js/stateManager.js"></script>
<script>
    var questions = []; // LIst of questions
    var questionHistory = []; // List of answered questions
    var questionHistoryIndex = -1;
    var questionType = ""
    var currentQuestion = -1;
    var nextQuestionId = -1;
    var answers = [];
    var conditionals = [];
    var progressBarStage = "You and your farm";
    var pdfData = [];

    // Printed/saved report
    var bestMatch;
    var bestMatchDescription;
    var bestMatchNote;
    var loanInfoCategory;
    
    var report = document.createElement("div");
    report.classList.add("result-container");
    report.setAttribute("id","report-container");
    $('#main-content').append(report);
    //$(report).hide();

    (function() {
        currentQuestion = 0;
        if(geAnswers() !== ""){
            questionHistory = JSON.parse(geAnswers());
            // Set the current question based on last unanswered question
            if(isNaN(questionHistory[0]['nextQuestionId'])) {
                currentQuestion = 0;
            }
            else{
                currentQuestion = Math.max.apply(null, questionHistory.map(object => { return object.nextQuestionId; }));
            }
        }

        // Get list of questions
        $.getJSON("../quiz.json", function(data) {
            questions = data["questions"];
            // Clean up assigned values
            for ( var i = 0; i < questions.length; i++ ) {
                // remove options
                var arr = questions[i].options.filter(function(x) {
                    return x.optionId !== -1;
                });
                questions[i].options = arr;
                // remove option paragraphs
                for ( var j = 0; j < questions[i].options.length; j++ ) {
                    arr = questions[i].options[j].paragraphs.filter(function(x) {
                        return x.paragraphText !== "";
                    });
                    questions[i].options[j].paragraphs = arr;
                }
                // remove content paragraphs
                arr = questions[i].content.paragraphs.filter(function(x) {
                    return x.paragraphText !== "";
                });
                questions[i].content.paragraphs = arr;
            }

            // Decide what to show
            // Open a URL or show quiz
            if(isNaN(currentQuestion)) {
                window.open(nextQuestionId);
                return;
            }
            else {
                showQuestion(currentQuestion);
            }
        });
    })();

    //////////////////
    // Quiz Logic
    //////////////////
    // Shows question
    function showQuestion(questionId) {
        // check the summary page should be loaded
        if(nextQuestionId === 9999 || currentQuestion === 9999) {
            progressBarStage = "Results";
            _createSummary();
        }
        else {
            $.each(questions, function(key, questionData) {
                if(questionData.questionId === questionId){
                    progressBarStage = questionData['progressBarStage'];
                    _createQuestionContainer();
                    currentQuestion = questionId;
                    answers = [];

                    var index = questionHistory.findIndex(x => x.question === currentQuestion);
                    questionHistoryIndex = index;
                    if(index === -1)
                    {
                        nextQuestionId = -1;
                        questionHistoryIndex = questionHistory.length;
                        questionHistory[questionHistoryIndex] = answer();
                    }
                    else {
                        answers = questionHistory[index]['answer'];
                        nextQuestionId = questionHistory[index]['nextQuestionId'];
                    }

                    questionType = questionData["type"];
                    switch (questionType) {
                        case 'information':
                            _createInformationCard(questionData);
                            break;
                        case 'multiselect':
                            _createMultiselctQuestion(questionData);
                            break;
                        case 'singlesselect':
                            _createSingleSelectQuestion(questionData);
                            break;
                        case 'yesno':
                            _createYesNoQuestion(questionData);
                            break;
                        case 'singleselectcards':
                            _createSingleSelectCardQuestion(questionData);
                            break;
                        default:
                            console.log(`not a valid type`);
                    };
                    _createBackStepLink();
                }
            });
        }
    }
    
    //////////////////
    // Summary Page
    //////////////////
    function _createProgressbar() {
        var progressBar = document.createElement("div");
        progressBar.classList.add("quiz-progress-bar-container");
        progressBar.setAttribute("id","progressbar"); 
        
        var map = document.createElement("div");
        map.classList.add("quiz-progress-bar-map-container");
        progressBar.append(map);
        
        var bar = document.createElement("div");
        bar.classList.add("quiz-progress-bar-map-bar-back");
        map.append(bar);

        var bar = document.createElement("div");
        bar.classList.add("quiz-progress-bar-map-bar");
        map.append(bar);
        
        var markers = document.createElement("div");
        markers.classList.add("quiz-progress-bar-map-bar-markers");
        
        var marker = document.createElement("div");
        marker.classList.add("quiz-progress-bar-map-bar-marker");
        marker.append(_createStepBullet(1, "fill-green"));
        markers.append(marker);

        marker = document.createElement("div");
        marker.classList.add("quiz-progress-bar-map-bar-marker");
        var fill = "border-grey"

        if(progressBarStage == "Loan Eligibility" || progressBarStage == "Results") {
            fill = "fill-green"
            bar.style.width = '35%';
        }
        marker.append(_createStepBullet(2, fill));
        markers.append(marker);
        
        marker = document.createElement("div");
        marker.classList.add("quiz-progress-bar-map-bar-marker");
        fill = "border-grey"
        if(progressBarStage == "Results") {
            fill = "fill-green"
            bar.style.width = '70%';
        }
        marker.append(_createStepBullet(3, fill));
        markers.append(marker);

        map.append(markers);
        progressBar.append(map);

        var labels = document.createElement("div");
        labels.classList.add("quiz-progress-bar-labels-container");

        var label = document.createElement("div");
        label.classList.add("quiz-progress-bar-label");
        label.textContent= "You and your farm"
        labels.append(label);

        label = document.createElement("div");
        label.classList.add("quiz-progress-bar-label");
        label.textContent = "Loan eligibility"
        labels.append(label);

        label = document.createElement("div");
        label.classList.add("quiz-progress-bar-label");
        label.textContent= "Results"
        labels.append(label);

        progressBar.append(labels);

        $('#progressbar').empty();
        return progressBar;
    }

    function _createQuestionContainer() {
        var container = document.createElement("div");
        container.classList.add("quiz-container");

        container.append(_createProgressbar());

        var backArrowContainer = document.createElement("div");
        backArrowContainer.classList.add("quiz-back-container");
        var backArrow = document.createElement("div");
        backArrow.classList.add("quiz-back");
        backArrow.id = "quiz-back";
        backArrowContainer.append(backArrow);
        container.append(backArrowContainer);

        var question = document.createElement("div");
        question.classList.add("quiz-questions-container");
        question.id = "quiz-questions-container";
        container.append(question);

        $('#summary-container').empty();
        $('#summary-container').append(container);
    }

    function _createSummary() {
        var sumarry = document.createElement("div");
        sumarry.classList.add("quiz-summary");
        
        sumarry.append(_createProgressbar());
        
        // Title
        var text = "FSA Farm Loan Quiz Results";
        sumarry.append(_createTitle(text));
        //Description
        text = "Based on your answers to the Farm Loan Quiz, we have matched you with a farm loan that will best fit your financing needs. Review the loan details and start your application process by completing the steps outline below.";
        sumarry.append(_createParagraphElement(text));

        // recomended loan
        sumarry.append(_createRecomendedLoans());
        
        // Flags
        text = "Below are the things we’ve flagged and recommend talking to your loan officer about.";
        sumarry.append(_createParagraphElement(text));
        sumarry.append(_createFlagMessages());
        
        // Steps
        sumarry.append(_createSummarySteps());

        $('#summary-container').empty();
        $('#summary-container').append(sumarry);
    }

    function _createRecomendedLoans() {
        // Has a main loan and posible additioonal recomendations
        var loans = document.createElement("div");
        
        // primary recomendation
        var loan = document.createElement("div");
        loans.append(loan);

        // recomended loan cards
        var recomended = document.createElement("div");
        recomended.classList.add("recomended-loans-container");
        loans.append(recomended);
        
        // add the loan details
        $.getJSON("/forms/loantypes.json", function(data) {
            var loanTypes = [...data['loanType']];
            var categories = [...data['categories']];
            var loanInfo = data['loanType'].find(x => x.loanID == questionHistory[0].answer[i]);

            questionHistory[0].answer.sort(function(a, b) {return b - a;} );
            for ( var i = 0; i < questionHistory[0].answer.length; i++ ) {
                var loanInfo = loanTypes.find(x => x.loanID == questionHistory[0].answer[i]);
                var category = categories.find(x => x.type == loanInfo.category);
                var loansInCategory = loanTypes.filter(x => x.category == category.type);
                recomended.append(_createSugestedLoanCards(category, loansInCategory, loanInfo, i, loan, recomended));
            }
        });
        return loans;
    }

    // shows a detailed view of the primary loan, and if available minimal details for other loan types
    // loanInfo = details from JSON, index = index from array of sugeted loans
    function _createSugestedLoanCards(category, loansInCategory, loanInfo, index, loan, recomended) {
        // Image
        var imageContainer = document.createElement("img");
        imageContainer.classList.add("recomended-imageContainer");

        var image = document.createElement("img");
        image.classList.add("recomended-image");
        image.src = './images/loantypes/'+loanInfo.image;
        loan.append(image);

        loan.append(_createTitle(loanInfo.category));
        // Description
        text = "Based on your responses we think you’re best suited for the FSA " + loanInfo.category + ".";
        loan.append(_createParagraphElement(text));
        loan.append(_createParagraphElement(category.description));
        loan.append(_createParagraphElement(category.note));

        loanInfoCategory = loanInfo.category
        bestMatch = text;
        bestMatchDescription = category.description;
        bestMatchNote = category.note;

        var loanCardHolder = document.createElement("div");
        loanCardHolder.classList.add("recomended-loan-card-holder");
        for ( var i = 0; i < loansInCategory.length; i++ ) {
            var loanCard = document.createElement("div");
            loanCard.classList.add("recomended-loans-card");
            // Name
            var title = document.createElement("div");
            title.classList.add("recomended-loans-card-title");
            title.textContent = loansInCategory[i].name;
            loanCard.append(title);

            // List of details
            var list = document.createElement("ul");
            // Max dollar ammount description
            let item = document.createElement("li");
            item.innerHTML = loansInCategory[i].maximumDollarAmountDescription;
            list.appendChild(item);

            // down payment description
            item = document.createElement("li");
            item.innerHTML = loansInCategory[i].downPaymentDescription;
            list.appendChild(item);

            // Loan term description
            item = document.createElement("li");
            item.innerHTML = loansInCategory[i].loanTermDescription;
            list.appendChild(item);

            // other requirements description
            if(loansInCategory[i].otherRequirements !== "N/A") {
                item = document.createElement("li");
                item.innerHTML = loansInCategory[i].otherRequirements;
                list.appendChild(item);
            }

            loanCard.append(list);

            loanCardHolder.append(loanCard);
        }
        loan.append(loanCardHolder);
        _createSaveableReport();
        return loan;
    }

    // Shows all flags in a list
    function _createFlagMessages() {
        var flagContainer = document.createElement("div");
        
        questions.sort((a, b) => a.notificationType.localeCompare(b.notificationType));

        var flagsList = questionHistory.filter(x=> x.answer[0] === 0);
        for (var i = 0; i < flagsList.length; i++) {
            var flagMessage = questions.find(x=> x.questionId === flagsList[i].question);
            flagContainer.append(_createFlag(flagMessage));
        }
        return flagContainer;
    }

    // The actual flag used in flag list and full report
    function _createFlag(flagMessage) {
        var flag = document.createElement("div");

        flag.classList.add("quiz-summary-flag");
        if(flagMessage.notificationType == "alert") {
            flag.classList.add("quiz-summary-flag-alert-background");
        }
        else {
            flag.classList.add("quiz-summary-flag-warning-background");
        }
        
        var div = document.createElement("div");
        div.classList.add("quiz-summary-flag-leftbar");
        if(flagMessage.notificationType == "alert") {
            div.classList.add("quiz-summary-flag-leftbar-alert-background");
        }
        else {
            div.classList.add("quiz-summary-flag-leftbar-warning-background");
        }
        flag.append(div);

        div = document.createElement("div");
        div.classList.add("quiz-summary-flag-iconholder");
        var image = document.createElement("img");
        if(flagMessage.notificationType == "alert"){
            image.src = './images/alerts/error.png';
        }
        else {
            image.src = './images/alerts/warning.png';
        }
        div.append(image);
        flag.append(div);

        var textHolder = document.createElement("div");
        textHolder.classList.add("quiz-summary-flag-text");

        div = document.createElement("div");
        div.classList.add("quiz-summary-flag-text-title");
        div.append(_createTitle(flagMessage.notificationTitle));
        textHolder.append(div);

        div = document.createElement("div");
        div.classList.add("quiz-summary-flag-text-message");
        div.textContent = flagMessage.notificationMessge;
        textHolder.append(div);

        flag.append(textHolder);

        return flag;
    }

    // The steps to apply for a loan
    function _createSummarySteps() {
        var stepinfo = [];
        stepinfo.push({
            "text": "Complete the readiness checklist",
            "message": "In addition to the quiz, you will need to bring a few other things to your meeting with your local loan officer.",
            "buttons": [ {
                    "buttonText": "DOWNLOAD READINESS CHECKLIST",
                    "buttonURL": "checklist",
                }
            ],
            "hasFulleReport": false,
        });
       
        stepinfo.push({
            "text": "Get help filling out the forms",
            "message": "Complete and print each form pertaining to your matched loan to add to your application package. We provide step-by-step instructions on completing each loan application form.",
            "buttons": [ {
                    "buttonText": "ACCESS FORMS",
                    "buttonURL": "onclick=showRelatedForms",
                }
            ],
            "hasFulleReport": false,
        });
       
        stepinfo.push({
            "text": "Find your local farm loan office",
            "message": "Find your local FSA Service Center and contact the Farm Loan Manager or the service center office.",
            "buttons": [ {
                    "buttonText": "FIND LOCAL FARM LOAN CENTER",
                    "buttonURL": "https://offices.sc.egov.usda.gov/locator/app?state=us&agency=fsa",
                }
            ],
            "hasFulleReport": false,
        });
 
        stepinfo.push({
            "text": "Download your quiz responses",
            "message": "We recommend downloading and/or printing the quiz and discussing your answers with your local loan officer.",
            "buttons": [ {
                    "buttonText": "DOWNLOAD QUIZ",
                    "buttonURL": "onclick=savePDF",
                },
                {
                    "buttonText": "PRINT QUIZ",
                    "buttonURL": "onclick=printPDF",
                }
            ],
            "hasFulleReport": true,
        });
   
        var steps = document.createElement("div");
        steps.classList.add("summary-step-container");
        
        for (var i = 0; i < stepinfo.length; i++) {
            var step = document.createElement("div");
            step.classList.add("summary-step");
            
            var div = document.createElement("div");
            div.classList.add("summary-step-iconholder");
            div.append(_createStepBullet(i+1, 'fill-green'));
            step.append(div);

            var textHolder = document.createElement("div");
            textHolder.classList.add("summary-step-text");

            div = document.createElement("div");
            div.classList.add("summary-step-text-title");
            div.textContent = stepinfo[i].text;
            textHolder.append(div);

            div = document.createElement("div");
            div.classList.add("summary-step-text-message");
            div.textContent = stepinfo[i].message
            textHolder.append(div);
            
            var buttonContainer = document.createElement("div");
            buttonContainer.classList.add("summary-step-text-button-container");
            for (var j = 0; j < stepinfo[i].buttons.length; j++) {
                var button = null;
                button = document.createElement('button');
                button.classList.add("summary-step-text-button");
                var text = document.createTextNode(stepinfo[i].buttons[j].buttonText);
                button.appendChild(text);

                if(stepinfo[i].buttons[j].buttonURL.includes("onclick")){
                    var func_name = stepinfo[i].buttons[j].buttonURL.split('=')[1];
                    $(button).off().on('click', eval(func_name).bind(this));
                    $(button).on('click',function() {
                        eval(func_name).bind(this);
                        $(this).off('click');
                    });
                }
                // else if(stepinfo[i].buttons[j].buttonURL == "checklist") {
                //     $.getJSON("/forms/loantypes.json", function(data) {
                //         var categories = [...data['categories']];
                //         var url = categories.find(x=> x.type == loanInfoCategory).checklist.toString();
                //         console.log(url)

                //         $(button).off().on('click', openURL.bind(this, url));
                //         $(button).on('click',function() {
                //             openURL.bind(this, url);
                //             $(this).off('click');
                //         });     
                //     })
                // }
                else {
                    $(button).off().on('click', openURL.bind(this, stepinfo[i].buttons[j].buttonURL));
                    $(button).on('click',function() {
                        openURL.bind(this, stepinfo[i].buttons[j].buttonURL);
                        $(this).off('click');
                    });                    
                }

                buttonContainer.append(button);
                textHolder.append(buttonContainer);
            }
                
            step.append(textHolder);
            
            if(stepinfo[i].hasFulleReport){
                step.append(_createFullReport());
            }
        
            steps.append(step);
        }
        return steps;
    }

    // The list of questions and answers shown in _createSummarySteps step 4
    function _createFullReport() {
        /////////////////
        //  Full Report
        var fullReport = document.createElement("div");
        fullReport.classList.add("full-report-container");

        text = "Full printable questionnaire";
        fullReport.append(_createTitle(text));

        text = "Print this out and bring it to your appointment with your loan officer to help guide your conversation.";
        fullReport.append(_createParagraphElement(text));

        // Results
        for( var i = 0; i < questionHistory.length; i++ ) {
            // Create a result container
            var result = document.createElement("div");
            result.classList.add("full-report-result-container");
            
            // Add a bullet
            var bullet = document.createElement("div");
            bullet.classList.add("full-report-result-bullet-container");
            bullet.append(_createStepBullet(i+1, 'border-green'));
            result.append(bullet);

            // Add the info to hold all of the details
            var info = document.createElement("div");
            info.classList.add("full-report-result-info");
            result.append(info);

            // Add Question Text
            var answerInfo = questions.find(x => x.questionId === questionHistory[i].question)
            var questionText = answerInfo['content'].title;
            var infoTitle = document.createElement("div");
            infoTitle.classList.add("full-report-result-info-title");
            infoTitle.append(_createTitle(questionText));
            info.append(infoTitle);

            //  Add Answer
            var answerText;
            var answerTexts = [...questionHistory[i].answer];
            for ( var j = 0; j < answerTexts.length; j++ ) {
                var answer = answerInfo.options.find(x => x.value === answerTexts[j]).title;
                answer = answer;
                var infoMessage = document.createElement("div");
                infoMessage.classList.add("full-report-result-info-message");
                infoMessage.append(_createParagraphElement(answer));
                info.append(infoMessage);
                
                var flagMessage = questions.find(x=> x.questionId === questionHistory[i].question);
                if(flagMessage.notificationType !== '') {
                    var flag = document.createElement("div");
                    flag.classList.add("full-report-result-info-flag");
                    flag.append(_createFlag(flagMessage)); 
                    info.append(flag);
                }
            }
            var qaPair = {
                "question": questionText,
                "answer": answer,
            }
            pdfData.push(qaPair);
            fullReport.append(result); 
        }
        return fullReport;
    }
    
    function _createSaveableReport() {
        var imageContainer = document.createElement("div");
        imageContainer.classList.add("result-image-container");
        
        var image = document.createElement("img");
        image.classList.add("result-image");
        image.setAttribute("src", "./images/usda_banner.png");
        imageContainer.append(image);
        report.append(imageContainer);

        var title = document.createElement("div");
        title.classList.add("result-title");
        title.textContent = "Loan quiz summary page";
        report.append(title);

        var subTitle = document.createElement("div");
        subTitle.classList.add("result-subTitle");
        subTitle.textContent = "Loan Assistance Tool, USDA Federal Service Agency";
        report.append(subTitle);

        var recommendation = document.createElement("div");
        recommendation.classList.add("result-recommendation");
        recommendation.textContent = "Loan recommendation";
        report.append(recommendation);

        var bestMatchText = document.createElement("div");
        bestMatchText.classList.add("result-recommendation");
        bestMatchText.textContent = bestMatch;
        report.append(bestMatchText);

        var bestMatchDescriptionText = document.createElement("div");
        bestMatchDescriptionText.classList.add("result-recommendation-description");
        bestMatchDescriptionText.textContent = bestMatchDescription;
        report.append(bestMatchDescriptionText);

        var bestMatchNoteText = document.createElement("div");
        bestMatchNoteText.classList.add("result-recommendation-note");
        bestMatchNoteText.textContent = bestMatchNote;
        report.append(bestMatchNoteText);
       
        var fullQuizText = document.createElement("div");
        fullQuizText.classList.add("result-recommendation-fullQuizText");
        fullQuizText.textContent = "Full quiz";
        report.append(fullQuizText);

        var fullQuizSubText = document.createElement("div");
        fullQuizSubText.classList.add("result-recommendation-fullQuizSubText");
        fullQuizSubText.textContent = "Below are all of the questions and answers to the quiz. We recommend you review these with your loan officer. ";
        report.append(fullQuizSubText);

        var resultContainer = document.createElement("div");
        resultContainer.classList.add("result-tile-container");
        for ( var i = 0; i < pdfData.length; i++ ) {
            var resultTile = document.createElement("div");
            resultTile.classList.add("result-tile");
            
            var resultNumber = document.createElement("div");
            resultNumber.classList.add("result-number");
            resultNumber.textContent = i + 1 +".";
            resultTile.append(resultNumber);

            var resultQuestion = document.createElement("div");
            resultQuestion.classList.add("result-question");
            resultQuestion.textContent = pdfData[i].question;
            resultTile.append(resultQuestion);

            var resultAnswer = document.createElement("div");
            resultAnswer.classList.add("result-answer");
            resultAnswer.textContent = pdfData[i].answer;
            resultTile.append(resultAnswer);
            
            resultContainer.append(resultTile);
        }
        report.append(resultContainer);
    }

    // The circle with a number to th eleft of steps and questions
    function _createStepBullet(number, type) {
        var bullet = document.createElement("div");
        bullet.classList.add("step-bullet");
        switch (type) {
            case 'fill-green':
                bullet.classList.add("step-bullet-green-fill");
                break; 
            case 'border-green':
                bullet.classList.add("step-bullet-green-border");
                break;
            case 'border-grey':
                bullet.classList.add("step-bullet-grey-border");
                break; 
        }
        bullet.textContent = number;
        return bullet;
    }
    
    ///////////////////////////////////////
    // Save, Next and Back functions
    ///////////////////////////////////////
    // Saves answer and shows next question
    function saveAndNext() {
        // Get list of answers from the multi select mnswers
        if(questionType == "multiselect") {
            if(answers.findIndex(x => x.value !== -1) > -1) {
                var multiAnswers = [];
                for ( var i = 0; i < answers.length; i++ ) { 
                    multiAnswers.push(answers[i]['value']);
                }
                answers = [...multiAnswers];
            }
        }

        // add answer to array
        var index  = questionHistory.findIndex(x => x.question === currentQuestion);

        questionHistory[index] = answer();

        updateAnswers();
        showQuestion(nextQuestionId);
    }
    
    // Creates a link to the next question.  If next step is based on user choice the link wil be inactive until choice is made
    function _createNextStepLink() {
        var parent = document.createElement('div');
        
        // Add inactive link
        var div = document.createElement('div');
        div.classList.add("quiz-next-inactive");
        div.id = 'quiz-next-inactive';
        var nextLink = document.createElement('a');
        nextLink.innerHTML = "Save and continue"
        nextLink.onclick = function() { null };
        div.appendChild(nextLink);
        parent.appendChild(div);
        
        // Add active link
        div = document.createElement('div');
        div.classList.add("quiz-next");
        div.id = 'quiz-next-active';

        nextLink = document.createElement('a');
        nextLink.innerHTML = "Save and continue"
        nextLink.onclick = function() { saveAndNext(); };
        div.appendChild(nextLink);
        parent.appendChild(div);
        return parent;
    }

    function setNextLinkValues() {
        $('#quiz-next-inactive').hide();
        $('#quiz-next-active').hide();

        if(nextQuestionId >= 0 || isNaN(nextQuestionId)) {
            $('#quiz-next-active').show();
        }
        else {
            $('#quiz-next-inactive').show();
        }
    }

    function _createBackStepLink() {
        $('#quiz-back').hide();

        if(questionHistory.length === 0) { return; }
        if(questionHistory[0]['question'] !== currentQuestion) {
            $('#quiz-back').show();
            var image = document.createElement("img");
            image.setAttribute("src", "./images/arrow-left.png");
            image.setAttribute("height", "32");
            image.setAttribute("width", "32");
            image.setAttribute("alt", "Back Arrow");

            var previoousLink = document.createElement('a');

            previoousLink.onclick = function() { 
                var id = questionHistory.findIndex(x => x.question === currentQuestion) -1;
                showQuestion(questionHistory.at(id)['question']);
                if(id === 0) {
                    $('#quiz-back').hide();
                }
                if(nextQuestionId === -1) {
                    questionHistory.pop();
                }
            }
            previoousLink.appendChild(image);
            $('#quiz-back').empty();
            $('#quiz-back').append(previoousLink);
        }
    }

    ///////////////////
    // Information Card
    ///////////////////
    // Creates an information question card: Text and a continue button
    function _createInformationCard(questionData) {
        nextQuestionId = questionData['options'][0]['nextQuestionId'];
        var question = document.createElement("div");
        question.classList.add("quiz-question");
        question.append(_createTitle(questionData['content']['title']));
        question.append(_createParagraphs(questionData['content']['paragraphs']));
        question.append(_createInformationButtons(questionData['options']));
        $('#quiz-questions-container').empty();
        $('#quiz-questions-container').append(question);
    }
    
    function _createInformationButtons(options) {
        var buttonDiv = document.createElement("div");
        for ( var i = 0; i < options.length; i++ ) {
            if(options[i]['title'] !== "") { 
                var button = document.createElement("button");
                button.type = "button";
                button.classList.add("btn");
                button.classList.add("btn-default");
                button.textContent = options[i]['title'];
                $(button).off().on('click', setInformationLinks.bind(this, options[i], button));
                $(button).on('click',function() {
                    setInformationLinks.bind(this, options[i], button);
                    $(this).off('click');
                });
                buttonDiv.append(button);
            }
        }
        return buttonDiv;
    }

    function setInformationLinks(option) {
        nextQuestionId = option.nextQuestionId;
        answers.push(option.value);
        saveAndNext();
    }

    ///////////////////////////
    // Multi-selection Question
    ///////////////////////////
    // Creates a MultiSelect question card: a grid of cards with checkboxes.  One or more must be selected to continue
    function _createMultiselctQuestion(questionData) {
        var question = document.createElement("div");
        question.classList.add("quiz-question");
        question.append(_createTitle(questionData['content']['title']));
        question.append(_createParagraphs(questionData['content']['paragraphs']));
        question.append(_createMultiSelectItems(questionData['options']));
        question.append(_createNextStepLink());
        $('#quiz-questions-container').empty();
        $('#quiz-questions-container').append(question);
   
        // Conditionals structure "1&2:12,1&3:1,2&3:2"
        // value&value:questionId
        var tmpConditionals = questionData['conditionals'].split(",");
        for ( var i = 0; i < tmpConditionals.length; i++ ) {
            var tmpCondition = tmpConditionals[i].split(":");
            var values = tmpCondition[0].split("&");
            var condition = {
                "value1": values[0],
                "value2": values[1],
                "nextQuestionId": tmpCondition[1]
            }
            conditionals.push(condition)
        }

        let data = questionHistory.find(x => x.question === currentQuestion);
        var checkboxesAll = [];
        checkboxesAll = [...question.querySelectorAll('input[type="checkbox"]')];        
        
        var tempArray = [];
        for ( var i = 0; i < data.answer.length; i++ ) { 
            var option = questionData['options'].find(x => x.value == data.answer[i]);
            var checkbox = checkboxesAll.find(x => x.name == data.answer[i]);
            if(checkbox !== undefined) {
                var answer = { value: option['value'], nextQuestionId: option['nextQuestionId'] };
                tempArray.push(answer);
                checkbox.classList.remove("quiz-multiSelect-card-container");
                checkbox.classList.add("quiz-multiSelect-card-container-selected");
                $(checkbox).prop('checked', true);
            }
            answers = [...tempArray]
        }

        setNextLinkValues();
    }

    function _createMultiSelectItems(options) {
        var gridDiv = document.createElement("div");
        gridDiv.classList.add("quiz-multiSelect-container");
        for (var i = 0; i < options.length; i++) {
            var cardDiv = document.createElement("div");
            cardDiv.classList.add("quiz-multiSelect-card-container");
            cardDiv.append(_createMultiselctCardTitle(options[i]['title']));
            cardDiv.append(_createParagraphs(options[i]['paragraphs']));
            cardDiv.append(_createMultiselctCardCheckbox(options[i]));
            gridDiv.append(cardDiv);
        }
        return gridDiv;
    }

    function _createMultiselctCardTitle(title) {
        var titleDiv = document.createElement("div");
        titleDiv.classList.add("quiz-MultiSelect-card-title-text");
        titleDiv.textContent = title;
        return titleDiv;  
    }

    function _createMultiselctCardCheckbox(option) {
        var checkboxDiv = document.createElement("div");
        checkboxDiv.classList.add("quiz-multiSelect-card-check-container");        
        
        var checkbox = document.createElement("INPUT");
        checkbox.setAttribute("type", "checkbox");
        checkbox.name = option['value'];
        checkbox.value = option['nextQuestionId'];

        $(checkbox).off().on('click', setMultiSelectAnswers.bind(this, option, checkbox));
        $(checkbox).on('click',function() {
            setMultiSelectAnswers.bind(this, option, checkbox);
            $(this).off('click');
        });

        checkboxDiv.appendChild(checkbox);
        return checkboxDiv;  
    }

    function setMultiSelectAnswers(option, checkbox) {
        $(checkbox).change(function() {
            if(this.checked) {
                nextQuestionId = option['nextQuestionId'];

                if(option['url'] !== "") {
                    nextQuestionId = option['url'];
                }
                else {
                    nextQuestionId = option['nextQuestionId'];
                }

                var answer = { value: option['value'], nextQuestionId: nextQuestionId };
                answers.push(answer);
                
                var selectedCheckbox = checkbox.closest(".quiz-multiSelect-card-container");
                selectedCheckbox.classList.remove("quiz-multiSelect-card-container");
                selectedCheckbox.classList.add("quiz-multiSelect-card-container-selected");
            }
            else {
                var selectedCheckbox = checkbox.closest(".quiz-multiSelect-card-container-selected");
                selectedCheckbox.classList.remove("quiz-multiSelect-card-container-selected");
                selectedCheckbox.classList.add("quiz-multiSelect-card-container");
                var index = answers.findIndex(x => x.value === option['value']);
                answers.splice(index, 1);
                if(answers.length === 0) {
                    nextQuestionId = -1;
                }
                else {
                    nextQuestionId = answers[0]['nextQuestionId'];
                }
            }
            
            checkConditionals();
            setNextLinkValues();
        });
    }

    function checkConditionals() {
        if(conditionals.length !==0) {
            for ( var i = 0; i < conditionals.length; i++ ) { 
                var hasValue1 = answers.some( x => x.value == parseInt(conditionals[i]['value1']));
                var hasValue2 = answers.some( x => x.value == parseInt(conditionals[i]['value2']));

                if(hasValue1 && hasValue2) {
                    nextQuestionId = parseInt(conditionals[i]['nextQuestionId']);
                }
            }
            var index = answers.findIndex(x => isNaN(x.nextQuestionId));

            if (index >= 0) {
                nextQuestionId = parseInt(answers[index]['nextQuestionId']);
            }
        }
    }
    
    ////////////////////////////
    // Single-select card elements
    ////////////////////////////
    // Creates cards with radio buttons
    function _createSingleSelectCardQuestion(questionData) {
        var question = document.createElement("div");
        question.classList.add("quiz-question");
        question.append(_createTitle(questionData['content']['title']));
        question.append(_createParagraphs(questionData['content']['paragraphs']));
        question.append(_createSingleSelectCardItems(questionData['options']));
        question.append(_createNextStepLink());
        $('#quiz-questions-container').empty();
        $('#quiz-questions-container').append(question);

        let data = questionHistory.find(x => x.question === currentQuestion);
        var radios = [];
        radios = [...question.querySelectorAll('input[type="radio"]')];        

        for ( var i = 0; i < data.answer.length; i++ ) { 
            var radio = radios.find(x => x.name == data.answer[i]);
            if(radio !== undefined) {
                answers[0] = data.answer[i];
                $(radio).prop('click', true);
            }
        }
        setNextLinkValues();
    }

    function _createSingleSelectCardItems(options) {
        var gridDiv = document.createElement("div");
        gridDiv.classList.add("quiz-multiSelect-container");
        for (var i = 0; i < options.length; i++) {
            if((options[i]['title']) != "") {
                var cardDiv = document.createElement("div");
                cardDiv.classList.add("quiz-multiSelect-card-container");
                cardDiv.append(_createMultiselctCardTitle(options[i]['title']));
                cardDiv.append(_createParagraphs(options[i]['paragraphs']));
                cardDiv.append(_createSingleSelectCardRadioButtons(options[i]));
                gridDiv.append(cardDiv);
            }
        }
        return gridDiv;
    }

    function _createSingleSelectCardRadioButtons(option) {
        var div = document.createElement("div");
        div.classList.add("quiz-singleSelectRadio-container");
        var label = document.createElement("label");
        var radio = document.createElement("input");
        radio.type = "radio";
        radio.name = option['value'];
        radio.value = option['nextQuestionId'];

        $(radio).off().on('click', setSingleSelectCardAnswer.bind(this, option, radio));
        $(radio).on('click',function() {
            setSingleSelectCardAnswer.bind(this, option, radio);
            $(this).off('click');
        });
        
        label.textContent = option.title
        div.appendChild(radio);
        div.appendChild(label);

        return div;
    }

    function setSingleSelectCardAnswer(option) {
        answers.push(option.optionId);
        nextQuestionId = option.nextQuestionId;
        setNextLinkValues();
    }

    ////////////////////////////
    // Single-selection elements
    ////////////////////////////
    // Creates a single select question card: two or more radio buttons
    function _createSingleSelectQuestion(questionData) {
        var question = document.createElement("div");
        question.classList.add("quiz-question");
        question.append(_createTitle(questionData['content']['title']));
        question.append(_createParagraphs(questionData['content']['paragraphs']));
        question.append(_createSingleSelectItems(questionData['options']));
        question.append(_createNextStepLink());
        $('#quiz-questions-container').empty();
        $('#quiz-questions-container').append(question);

        SetAnsweredRadioState(question);
        setNextLinkValues();
    }

    function _createSingleSelectItems(options) {
        var gridDiv = document.createElement("div");
        for ( var i = 0; i < options.length; i++ ) {
            if(options[i]["optionId"] !== -1) { 
                gridDiv.append(_createRadioButtons(options[i]));
                //gridDiv.append(cardDiv);
            }
        }
        return gridDiv;
    }

    function _createRadioButtons(option) {
        var div = document.createElement("div");
        var label = document.createElement("label");
        var labelText = document.createElement("p");
        var radio = document.createElement("input");
        radio.type = "radio";
        radio.name = "radio";
        radio.id = option['value'];
        radio.value = option['nextQuestionId'];

        $(radio).off().on('click', setSingleSelectAnswers.bind(this, option, radio));
        $(radio).on('click',function() {
            setSingleSelectAnswers.bind(this, option, radio);
            $(this).off('click');
        });
        
        labelText.textContent = option.title
        label.appendChild(radio);
        label.appendChild(labelText);
        div.appendChild(label);

        return div;
    }

    function setSingleSelectAnswers(option) {
        answers = [];
        answers.push(option.value);
        nextQuestionId = option.nextQuestionId;
        setNextLinkValues();
    }

    //////////////////
    // Yes/No elements
    //////////////////
    // Creates a single select question card: two or more radio buttons
    function _createYesNoQuestion(questionData) {
        var question = document.createElement("div");
        question.classList.add("quiz-question");
        question.append(_createTitle(questionData['content']['title']));
        question.append(_createParagraphs(questionData['content']['paragraphs']));
        question.append(_createYesNoItems(questionData['options']));
        question.append(_createNextStepLink());
        $('#quiz-questions-container').empty();
        $('#quiz-questions-container').append(question);
        
        SetAnsweredRadioState(question);
        setNextLinkValues();
    }

    function _createYesNoItems(options) {
        var buttonDiv = document.createElement("div");
        buttonDiv.classList.add("btn-group");
        for ( var i = 0; i < options.length; i++ ) {
            if(options[i]["optionId"] !== -1) { 
                buttonDiv.append(_createYesNoButtons(options[i]));
            }
        }
        return buttonDiv;
    }

    function _createYesNoButtons(option) {
        var button = document.createElement("div");
        button.classList.add("button");
        
        var radio = document.createElement("input");
        radio.type = "radio";
        radio.name = "choices";
        radio.id = option['value'];
        radio.value = option['nextQuestionId'];

        var label = document.createElement("label");
        label.classList.add(".btn");
        label.classList.add(".btn-default");
        label.textContent = option.title;

        button.append(radio);
        button.append(label);

        $(button).off().on('click', setYesNoAnswers.bind(this, option, button));
        $(button).on('click',function() {
            setYesNoAnswers.bind(this, option, button);
            $(this).off('click');
        });
 
        return button;
    }

    function setYesNoAnswers(option) {
        answers = [];
        answers.push(option.value);
        nextQuestionId = option.nextQuestionId;
        setNextLinkValues();
    }

    //////////////////
    // Common Elements
    //////////////////
    // Creates a bold title
    function _createTitle(title) {
        if(title == "") { return }
        var titleDiv = document.createElement("div");
        titleDiv.classList.add("quiz-title-text");
        titleDiv.textContent = title
        return titleDiv;
    }

    // Creates one or more paragraphs
    function _createParagraphs(paragraphs) {
        if(paragraphs == "") { return }

        var gridDiv = document.createElement("div");
        gridDiv.classList.add("quiz-paragraph-text");
        for (var i = 0; i < paragraphs.length; i++) {
            var paragraph = paragraphs[i];
            var paragraphText = paragraph.paragraphText;
            // For each paragraph, check if it's a string or an object 
            if (paragraphText !== null && paragraphText !== undefined) {
                // If it's a string, then create a simple paragraph element
                if (typeof paragraphText === 'string' || paragraphText instanceof String) {
                    var paragraphElement = _createParagraphElement(paragraphText);
                    // If it's an object, then it should represent a bulvared list, so create that instead
                } else if (typeof paragraphText === 'object' && !Array.isArray(paragraphText)) {
                    var paragraphElement = _createBulvaredListElement(paragraphText.bulvars, paragraphText.type);
                } else {
                    alert("Unrecognized paragraphText element detected: " + paragraphText.toString());
                }
            }
            // Append the paragraph to the parent div
            gridDiv.appendChild(paragraphElement);
        }

        return gridDiv;
    }

    // Creates each paragraph text
    function _createParagraphElement(paragraphText) {
        var paragraphElement = document.createElement("p");
        paragraphElement.appendChild(document.createTextNode(paragraphText));
        return paragraphElement;
    }

    ///////////////////////////////////
    // Load and save answered questions
    ///////////////////////////////////
    function updateAnswers() {
        setCookie("answers", JSON.stringify(questionHistory), 365);
    }

    function geAnswers() {
        return getCookie('answers');
    }

    function answer() {
        return {
            "question": currentQuestion,
            "answer": answers,
            "nextQuestionId": nextQuestionId
        }
    }

    function SetAnsweredRadioState(question) {
        let data = questionHistory.find(x => x.question === currentQuestion);
        var radios = [];
        radios = [...question.querySelectorAll('input[type="radio"]')];        

        for ( var i = 0; i < data.answer.length; i++ ) { 
            var radio = radios.find(x => x.id == data.answer[i]);

        if(radio !== undefined) {
                answers[0] = data.answer[i];
                $(radio).prop('checked', true);
            }
        }
    }

    ///////////////////////////////////
    // Utilities
    ///////////////////////////////////
    function showRelatedForms() {
        setloanType(loanInfoCategory);
        setContent("loanforms");
    }

    function openURL(url) {
        console.log(url)
        window.location = url;
    }

    function savePDF() {
        $(report).show();
        var HTML_Width = $(report).width();
        var HTML_Height = $(report).height();
        var top_left_margin = 15;
        var PDF_Width = HTML_Width + (top_left_margin * 2);
        var PDF_Height = (PDF_Width * 1.5) + (top_left_margin * 2);
        var canvas_image_width = HTML_Width;
        var canvas_image_height = HTML_Height;

        var totalPDFPages = Math.ceil(HTML_Height / PDF_Height) - 1;

        html2canvas(report).then((canvas) => {
            var imgData = canvas.toDataURL("image/png", 1.0);
            var pdf = new jsPDF('p', 'pt', [PDF_Width, PDF_Height]);
            pdf.addImage(imgData, 'PNG', top_left_margin, top_left_margin, canvas_image_width, canvas_image_height);
            for (var i = 1; i <= totalPDFPages; i++) { 
                pdf.addPage(PDF_Width, PDF_Height);
                pdf.addImage(imgData, 'PNG', top_left_margin, -(PDF_Height*i)+(top_left_margin*4),canvas_image_width,canvas_image_height);
            }
            $(report).hide();
            pdf.save("Loan Quiz Summary.pdf");
        });
    }
    
    function printPDF() {
        $(report).show();
        html2canvas(report).then((canvas) => {
            var myImage = canvas.toDataURL("image/png");
            var tWindow = window.open("");
            $(tWindow.document.body).html("<img id='Image' src=" + myImage + " 'style='max-width:50%;'></img>").ready(function() {
                tWindow.focus();
                tWindow.print();
            });
        });
        $(report).hide();
    }
    
</script>